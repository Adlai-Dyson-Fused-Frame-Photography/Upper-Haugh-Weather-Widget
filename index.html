<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upper Haugh Compact</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Use system fonts if Aptos fails to load to prevent invisible text */
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      font-family: 'Aptos', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #111827; /* Fallback */
      background-image: linear-gradient(135deg, #111827 0%, #1e374d 100%);
      color: #ffffff;
      overflow: hidden;
    }

    .widget-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 6px;
      box-sizing: border-box;
    }

    /* Removed backdrop-filter for better compatibility */
    .glass-panel {
      background: rgba(30, 55, 77, 0.85); 
      border: 1px solid rgba(148, 253, 248, 0.3);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 8px;
      box-sizing: border-box;
    }

    /* Header */
    .header { text-align: center; margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .location { font-size: 1.1rem; font-weight: bold; color: #94fdf8; margin: 0; }
    .date { font-size: 0.7rem; opacity: 0.8; margin-bottom: 4px; }

    /* Main Section */
    .main-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1; /* Takes up available middle space */
    }
    .temp-val { font-size: 2.8rem; font-weight: 300; line-height: 1; }
    .main-icon-box { text-align: center; }
    .main-icon { font-size: 1.8rem; display: block; }
    .desc { font-size: 0.75rem; text-transform: capitalize; }

    /* Hourly Section - Simplified Flex */
    .hourly-row {
      display: flex;
      justify-content: space-around;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 5px 0;
      margin: 4px 0;
    }
    .hour-item { text-align: center; font-size: 0.7rem; }
    .h-time { color: #94fdf8; font-weight: bold; margin-bottom: 2px; }
    .h-icon { font-size: 0.9rem; margin: 2px 0; }
    .h-temp { font-weight: bold; }

    /* Meta Grid - Replaced Grid with Flex Rows for compatibility */
    .stats-container { display: flex; flex-direction: column; gap: 4px; }
    .stats-row { display: flex; justify-content: space-between; }
    .stat-box { 
      background: rgba(255,255,255,0.05); 
      padding: 4px 8px; 
      border-radius: 6px; 
      width: 48%; 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      box-sizing: border-box;
    }
    .stat-label { font-size: 0.65rem; opacity: 0.7; }
    .stat-val { font-size: 0.8rem; font-weight: bold; }

    /* Colors */
    .c-sun { color: #facc15; }
    .c-rain { color: #60a5fa; }
    .c-cloud { color: #9ca3af; }
  </style>
</head>
<body>

  <div class="widget-container">
    <div class="glass-panel">
      
      <div class="header">
        <div class="location">Upper Haugh</div>
        <div class="date" id="date">--</div>
      </div>

      <div class="main-row">
        <div class="temp-val" id="temp">--°</div>
        <div class="main-icon-box">
          <i id="main-icon" class="fa-solid fa-circle-notch fa-spin"></i>
          <div class="desc" id="desc">Loading</div>
        </div>
      </div>

      <div class="hourly-row" id="hourly">
        </div>

      <div class="stats-container">
        <div class="stats-row">
          <div class="stat-box">
            <span class="stat-label">Wind</span>
            <span class="stat-val" id="wind">--</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">Hum</span>
            <span class="stat-val" id="hum">--</span>
          </div>
        </div>
        <div class="stats-row">
          <div class="stat-box">
            <span class="stat-label">UV</span>
            <span class="stat-val" id="uv">--</span>
          </div>
          <div class="stat-box">
            <span class="stat-label">AQI</span>
            <span class="stat-val" id="aqi">--</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const API = 'https://api.upperhaughweather.uk/weather';

    function getIcon(id) {
      if (id < 600) return { i: 'fa-cloud-showers-heavy', c: 'c-rain' };
      if (id < 700) return { i: 'fa-snowflake', c: '' };
      if (id === 800) return { i: 'fa-sun', c: 'c-sun' };
      return { i: 'fa-cloud', c: 'c-cloud' };
    }

    async function update() {
      try {
        const r = await fetch(API, { cache: 'no-store' });
        const d = await r.json();
        const c = d.weather.current;

        // Date
        const now = new Date();
        document.getElementById('date').innerText = now.toLocaleDateString('en-GB', { day:'numeric', month:'short' });

        // Current
        document.getElementById('temp').innerText = Math.round(c.temp) + '°';
        document.getElementById('desc').innerText = c.weather[0].main;
        const icon = getIcon(c.weather[0].id);
        document.getElementById('main-icon').className = `fa-solid ${icon.i} main-icon ${icon.c}`;

        // Hourly (Top 4)
        const hCont = document.getElementById('hourly');
        hCont.innerHTML = '';
        d.weather.hourly.slice(1, 5).forEach(h => {
          const ico = getIcon(h.weather[0].id);
          const time = new Date(h.dt * 1000).getHours();
          const displayTime = time > 12 ? (time-12)+'pm' : (time===0?'12am':time+'am');
          
          hCont.innerHTML += `
            <div class="hour-item">
              <div class="h-time">${displayTime}</div>
              <i class="fa-solid ${ico.i} h-icon ${ico.c}"></i>
              <div class="h-temp">${Math.round(h.temp)}°</div>
            </div>`;
        });

        // Stats
        document.getElementById('wind').innerText = Math.round(c.wind_speed * 2.23) + 'm';
        document.getElementById('hum').innerText = c.humidity + '%';
        document.getElementById('uv').innerText = Math.round(c.uvi);
        
        const aqiVal = d.airPollution?.list?.[0]?.main?.aqi || 1;
        document.getElementById('aqi').innerText = ['Good','Fair','Mod','Poor','Bad'][aqiVal-1];

      } catch (err) { console.log(err); }
    }

    update();
    setInterval(update, 120000);
  </script>
</body>
</html>
